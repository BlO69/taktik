<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Taktik — Duel 20x20 (5 en ligne)</title>
  <style>
    :root{
      --size:20; /* taille de la grille */
      --cell-size:34px;
      --board-bg:#0b1220;
      --accent-1:#ffb100; /* or / gold */
      --accent-2:#ff3f3f; /* red */
      --accent-3:#2ea3ff; /* blue */
      --glass: rgba(255,255,255,0.06);
      --metal: linear-gradient(145deg,#2b2f36,#131418);
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#eee;background: radial-gradient(closest-side at 10% 20%, rgba(46,163,255,0.06) 0%, transparent 12%), radial-gradient(closest-side at 90% 80%, rgba(255,160,0,0.06) 0%, transparent 10%), #03040a;display:flex;align-items:center;justify-content:center}

    .container{width:calc(var(--cell-size)*var(--size) + 320px);max-width:calc(100% - 32px);display:flex;gap:24px;align-items:flex-start}

    /* logo / title */
    .panel{width:300px;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));border-radius:14px;box-shadow:0 8px 40px rgba(0,0,0,0.6), inset 0 1px rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
    .logo{display:flex;align-items:center;gap:14px;margin-bottom:12px}
    .logo .emblem{width:70px;height:70px;border-radius:10px;background: linear-gradient(135deg,#0f2a47 0%, #072033 40%, #001116 100%), radial-gradient(circle at 30% 20%, rgba(255,255,255,0.06), transparent 20%);box-shadow:0 6px 18px rgba(0,0,0,0.6), inset 0 2px 8px rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center;position:relative}
    .logo .emblem::after{content:'+';font-weight:800;color:var(--accent-1);font-size:34px;text-shadow:0 2px 6px rgba(0,0,0,0.6)}
    .logo h1{margin:0;font-size:28px;line-height:1;color:linear-gradient(90deg,#fff,#ffd27a)}
    .subtitle{font-size:12px;opacity:0.9;margin-top:6px}

    .stats{margin-top:12px}
    .stat-row{display:flex;justify-content:space-between;padding:8px 6px;border-radius:8px;background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(255,255,255,0.01));margin-bottom:8px;font-size:14px}

    button.btn{display:inline-block;padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(180deg, #ffd27a,#ff9a00);color:#111;font-weight:700;cursor:pointer;box-shadow:0 6px 20px rgba(255,154,0,0.18)}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff}

    /* board area */
    .board-wrap{background:var(--metal);padding:18px;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.6), inset 0 2px rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04)}
    .board{display:grid;grid-template-columns:repeat(var(--size), var(--cell-size));grid-template-rows:repeat(var(--size), var(--cell-size));gap:6px;background:linear-gradient(180deg,#071226 0%, #06121b 100%);padding:12px;border-radius:12px}

    .cell{width:var(--cell-size);height:var(--cell-size);border-radius:6px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.14));position:relative;cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,0.6), inset 0 -1px rgba(255,255,255,0.02)}
    .cell:hover{transform:translateY(-2px);transition:transform 140ms}

    .piece{width:78%;height:78%;border-radius:50%;position:relative;box-shadow:0 6px 14px rgba(0,0,0,0.6), inset 0 2px rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center}
    .piece::before{content:'';position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 30% 25%, rgba(255,255,255,0.35), rgba(255,255,255,0.05) 10%, transparent 30%)}

    .piece.red{background: radial-gradient(circle at 30% 30%, #ff9a9a, #ff3434 50%, #b71717 100%);border:2px solid rgba(0,0,0,0.45)}
    .piece.blue{background: radial-gradient(circle at 30% 30%, #9fdcff, #2ea3ff 50%, #1b6fb3 100%);border:2px solid rgba(0,0,0,0.45)}
    .piece.gold{background: radial-gradient(circle at 30% 30%, #fff2cc, #ffd27a 50%, #b87a00 100%);border:2px solid rgba(0,0,0,0.45)}

    .info{color:#dbe9ff;font-size:13px}

    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(0,0,0,0.5), rgba(0,0,0,0.7));backdrop-filter: blur(6px);opacity:0;pointer-events:none;transition:opacity 180ms}
    .overlay.show{opacity:1;pointer-events:auto}
    .modal{min-width:320px;padding:26px;border-radius:12px;background:linear-gradient(180deg,#0d1620,#061018);box-shadow:0 20px 60px rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.03);text-align:center}
    .winner-piece{display:inline-block;width:48px;height:48px;border-radius:50%;margin-bottom:12px}

    .cell.win{outline:3px solid rgba(255,255,255,0.12);box-shadow:0 6px 18px rgba(255,255,255,0.06), 0 0 20px rgba(255,255,255,0.02) inset}

    /* responsive */
    @media (max-width:980px){.container{flex-direction:column;align-items:center}.panel{width:100%;max-width:520px}.board-wrap{width:100%;max-width:calc(var(--cell-size)*var(--size) + 36px);overflow:auto}}
  </style>
</head>
<body>
  <div class="container">
    <div class="panel">
      <div class="logo">
        <div class="emblem"></div>
        <div>
          <h1>TAKTIK</h1>
          <div class="subtitle">Duel 20×20 — 5 en ligne</div>
        </div>
      </div>

      <div class="stats">
        <div class="stat-row"><div>Joueur 1</div><div id="p1score">0</div></div>
        <div class="stat-row"><div>Joueur 2</div><div id="p2score">0</div></div>
        <div class="stat-row"><div>Tour</div><div id="turnLabel">1 — Rouge</div></div>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="restartBtn">Recommencer</button>
          <button class="ghost" id="resetScoreBtn">Réinitialiser scores</button>
        </div>
      </div>

      <div style="margin-top:12px;font-size:13px;opacity:0.9">
        <div class="info">Posez vos pions en cliquant sur une case. Le premier à aligner 5 pions gagne. Alternance automatique.</div>
      </div>
    </div>

    <div class="board-wrap">
      <div id="board" class="board" aria-label="Plateau de jeu"></div>
    </div>
  </div>

  <!-- modal -->
  <div id="overlay" class="overlay" role="dialog" aria-hidden="true">
    <div class="modal">
      <div id="winnerPiece" class="winner-piece"></div>
      <h2 id="winnerText">Le gagnant !</h2>
      <div style="margin-top:12px"><button class="btn" id="closeModal">OK</button></div>
    </div>
  </div>

  <script>
    const SIZE = 20;
    const WIN_CONSEC = 5;
    const boardEl = document.getElementById('board');
    const turnLabel = document.getElementById('turnLabel');
    const restartBtn = document.getElementById('restartBtn');
    const resetScoreBtn = document.getElementById('resetScoreBtn');
    const overlay = document.getElementById('overlay');
    const winnerText = document.getElementById('winnerText');
    const winnerPiece = document.getElementById('winnerPiece');

    // state
    let grid = [];
    let current = 1; // 1 = red, 2 = blue
    let gameOver = false;
    let scores = {p1:0,p2:0};

    function initGrid(){
      grid = new Array(SIZE).fill(0).map(()=>new Array(SIZE).fill(0));
    }

    function createBoard(){
      boardEl.innerHTML='';
      boardEl.style.setProperty('--size', SIZE);
      for(let y=0;y<SIZE;y++){
        for(let x=0;x<SIZE;x++){
          const cell = document.createElement('button');
          cell.className='cell';
          cell.dataset.x = x;
          cell.dataset.y = y;
          cell.addEventListener('click', onCellClick);
          boardEl.appendChild(cell);
        }
      }
    }

    function onCellClick(e){
      if(gameOver) return;
      const x = Number(e.currentTarget.dataset.x);
      const y = Number(e.currentTarget.dataset.y);
      if(grid[y][x] !== 0) return; // déjà pris
      placePiece(x,y,current);
      if(checkWin(x,y,current)){
        gameOver = true;
        announceWinner(current);
        if(current===1) scores.p1++ ; else scores.p2++;
        updateScores();
      } else {
        current = (current===1?2:1);
        updateTurnLabel();
      }
    }

    function placePiece(x,y,player){
      grid[y][x] = player;
      const idx = y*SIZE + x;
      const cell = boardEl.children[idx];
      const piece = document.createElement('div');
      piece.className = 'piece ' + (player===1 ? 'red' : 'blue');
      // subtle scale-in animation
      piece.style.transform='scale(0.6)';
      piece.style.transition='transform 160ms cubic-bezier(.2,.9,.3,1)';
      cell.appendChild(piece);
      requestAnimationFrame(()=>{ piece.style.transform='scale(1)'; });
    }

    function updateTurnLabel(){
      turnLabel.textContent = (current===1? 'Tour — Rouge' : 'Tour — Bleu');
    }

    function updateScores(){
      document.getElementById('p1score').textContent = scores.p1;
      document.getElementById('p2score').textContent = scores.p2;
    }

    function announceWinner(player){
      winnerText.textContent = (player===1? 'Rouge gagne !' : 'Bleu gagne !');
      winnerPiece.className = 'winner-piece ' + (player===1? 'piece red' : 'piece blue');
      overlay.classList.add('show');
      overlay.setAttribute('aria-hidden','false');
    }

    document.getElementById('closeModal').addEventListener('click', ()=>{
      overlay.classList.remove('show');
      overlay.setAttribute('aria-hidden','true');
    });

    restartBtn.addEventListener('click', ()=>{
      resetBoard();
    });
    resetScoreBtn.addEventListener('click', ()=>{
      scores.p1 = 0; scores.p2 = 0; updateScores();
    });

    function resetBoard(){
      initGrid();
      createBoard();
      current = 1; gameOver = false; updateTurnLabel();
    }

    // vérification de victoire: compte consécutifs dans 4 directions
    function checkWin(x,y,player){
      const dirs = [ [1,0],[0,1],[1,1],[1,-1] ];
      for(const [dx,dy] of dirs){
        let count = 1;
        // vers l'avant
        let nx = x + dx; let ny = y + dy;
        while(inBounds(nx,ny) && grid[ny][nx]===player){ count++; nx+=dx; ny+=dy; }
        // vers l'arrière
        nx = x - dx; ny = y - dy;
        while(inBounds(nx,ny) && grid[ny][nx]===player){ count++; nx-=dx; ny-=dy; }
        if(count >= WIN_CONSEC){
          // mise en évidence de la ligne gagnante
          highlightLine(x,y,dx,dy,player);
          return true;
        }
      }
      return false;
    }

    function inBounds(x,y){ return x>=0 && x<SIZE && y>=0 && y<SIZE; }

    function highlightLine(x,y,dx,dy,player){
      const toHighlight = [];
      // partir de la cellule (x,y) aller dans -dx,-dy jusqu'au début
      let sx = x; let sy = y;
      while(inBounds(sx-dx,sy-dy) && grid[sy-dy][sx-dx]===player){ sx -= dx; sy -= dy; }
      // maintenant avancer en collectant
      let cx=sx, cy=sy;
      while(inBounds(cx,cy) && grid[cy][cx]===player){ toHighlight.push([cx,cy]); cx+=dx; cy+=dy; }
      // n'afficher que la première séquence de longueur WIN_CONSEC si plus longue
      if(toHighlight.length > WIN_CONSEC){
        toHighlight.splice(WIN_CONSEC); // garder les WIN_CONSEC premiers
      }
      // ajouter classe .win
      toHighlight.forEach(([hx,hy])=>{
        const idx = hy*SIZE + hx;
        const cell = boardEl.children[idx];
        if(cell) cell.classList.add('win');
      });
    }

    // initialisation
    initGrid();
    createBoard();
    updateTurnLabel();
    updateScores();

  </script>
</body>
</html>

